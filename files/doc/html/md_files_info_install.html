<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>pi-loop: install</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">pi-loop
   &#160;<span id="projectnumber">0.9(prototype)</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">install </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Instructions section</h1>
<h4>You may follow the instructions bellow to build configure and run the application.</h4>
<h2>Table of contents</h2>
<ul>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#configure">Configure</a></li>
<li><a href="#build">Build</a></li>
<li><a href="#run">Run</a></li>
<li><a href="#help">Help</a></li>
</ul>
<h2>Prerequisites</h2>
<p>The things you need before building the software:</p>
<ul>
<li><a href="https://github.com/jackaudio/jack2">jack audio</a><ul>
<li>To install jack audio you must build it from source with <code>pkg-config</code>, <code>alsa</code> and <code>libsamplerate</code>. For further guidance, visit the <a href="#help">help section</a>.</li>
</ul>
</li>
<li><a href="https://github.com/adamstark/AudioFile">jsoncpp</a></li>
<li><a href="https://github.com/adamstark/AudioFile">Audiofile</a></li>
<li><a href="https://www.freedesktop.org/wiki/Software/libevdev/">libevdev</a>(<b>PC mode only</b>)</li>
<li><a href="https://github.com/WiringPi/WiringPi">wiringPi</a> (<b>RPI mode only</b>)</li>
</ul>
<h2>Configure</h2>
<p>To configure Piloop before building, you <b>must</b> follow the configuration steps listed below: </p><h3>1.configure the audio card</h3>
<p>Detect the audio card using one of the following ways. To list the available audio cards on your system, type the following on a terminal:<br  />
</p>
<div class="fragment"><div class="line">cat /proc/asound/cards</div>
</div><!-- fragment --><p>Sample output: </p><h3 align="left"><img src="imgs/proc_asound_cards_output.png" alt="" width="500" class="inline"/></h3>
<p>.. or alternatively..<br  />
</p>
<div class="fragment"><div class="line">aplay -l</div>
</div><!-- fragment --><p>Sample output: </p><h3 align="left"><img src="imgs/aplay_output.png" alt="" width="500" class="inline"/></h3>
<p>In the <code>CMakeLists.txt</code> or in the <code>Makefile</code> (depending how you choose to compile), replace the variable <code>AUDIO_INTERFACE</code> with the corresponding name of your sound card (i.e. in this example with the name <code>PCH</code> which corresponds to the system's audio card).</p>
<h3>2.set the mode to run Piloop</h3>
<p>In a similar manner, set the variable <code>MODE</code> to <code>PC</code> if you want to use you computer components (such as the computer-keyboard and the computer's screen) or <code>RPI</code> if you are on a Raspberry Pi (with buttons and LEDs connected to the GPIO pins).</p>
<h3>3.set the keyboard device (<b>PC mode only</b>)</h3>
<p>Type in terminal:</p>
<div class="fragment"><div class="line">ls -l /dev/input/by-path</div>
</div><!-- fragment --><p>Sample output: </p><h3 align="left"><img src="imgs/keyboard_device.png" alt="" width="700" class="inline"/></h3>
<p>In this example, the output states that the keyboard corresponds to <code>event3</code>. Simply then open the file <a href="../include/computer/keyboard.h">include/computer/keyboard.h</a> and replace the line :</p>
<div class="fragment"><div class="line">static const char *eventDevice = &quot;/dev/input/event..&quot;;</div>
</div><!-- fragment --><p>with</p>
<div class="fragment"><div class="line">static const char *eventDevice = &quot;/dev/input/event3&quot;;</div>
</div><!-- fragment --><h3>4.set sample rate and buffer size (optional)</h3>
<p>Open the <a href="../include/audio_settings.h">include/audio_settings.h</a> and replace the values of <code>SAMPLE_RATE</code> and <code>BUFFER_SIZE</code> with the desired values. </p><div class="fragment"><div class="line">#define BUFFER_SIZE 512</div>
<div class="line">#define SAMPLE_RATE 44100</div>
</div><!-- fragment --><p><code>NOTE:</code> <em>make sure that the value of sampling rate is supported by the audio card. To check the available options run <code>cat /proc/asound/card&lt;card_id&gt;/codec#0</code>.</em></p>
<h2>Build</h2>
<p>To build the application, you can use either <code>make</code> or <code>cmake</code>.</p>
<p>To build with <code>cmake</code>, run:</p>
<div class="fragment"><div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake ..</div>
<div class="line">cmake --build .</div>
<div class="line">mv piloop ../</div>
<div class="line">cd ..</div>
</div><!-- fragment --><p>or use the script provided as follows:</p>
<div class="fragment"><div class="line">bash start.sh b</div>
</div><!-- fragment --><p>To build with <code>make</code>, run: </p><div class="fragment"><div class="line">make</div>
</div><!-- fragment --><p>The resulted binary will be found at the root directory of the local repository.</p>
<h2>Run</h2>
<p>After having complete the installation, you ll' find <code>piloop</code> binary file within <code>pi-loop-console</code> directory (<em>root of the local repository</em>). You may run <code>Piloop</code> with:</p>
<div class="fragment"><div class="line">cd pi-loop-console</div>
<div class="line">sudo ./piloop</div>
</div><!-- fragment --><h2>Help</h2>
<h4>Installing jack from source files</h4>
<p>To install jack audio you must <a href="https://jackaudio.org/faq/build_info.html">build it from source</a> with <code>pkg-config</code>, <code>alsa</code> and <code>libsamplerate</code> enabled and <code>D-Bus</code> should be preferably disabled. Additionally <code>GNU compiler</code> and <code>Python</code> must also be installed on your system.</p>
<p>For example, on a debian-based system, proceed as follows: </p><div class="fragment"><div class="line">sudo apt update &amp;&amp; sudo apt-get update </div>
<div class="line"> </div>
<div class="line">## install g++</div>
<div class="line">apt update &amp;&amp; apt -y install build-essential</div>
<div class="line"> </div>
<div class="line">## install python</div>
<div class="line">sudo apt-get install python3</div>
<div class="line">ln -s /usr/bin/python3 /usr/bin/python</div>
<div class="line"> </div>
<div class="line">## install pkg-config</div>
<div class="line">sudo apt -y install pkg-config</div>
<div class="line"> </div>
<div class="line">## install libsamplerate</div>
<div class="line">sudo apt-get install -y libsamplerate0 libsamplerate0-dev</div>
<div class="line"> </div>
<div class="line">## install alsa driver </div>
<div class="line">sudo apt-get -y install alsa-utils libasound2-dev libasound2-data</div>
<div class="line"> </div>
<div class="line">## download jack repository - https://github.com/jackaudio/jack2</div>
<div class="line">git clone https://github.com/jackaudio/jack2.git</div>
<div class="line"> </div>
<div class="line">cd jack2</div>
<div class="line"> </div>
<div class="line"># configure jack with pkg-config, alsa and libsamplerate enabled</div>
<div class="line">./waf configure --prefix /usr</div>
<div class="line"> </div>
<div class="line"># before proceeding, </div>
<div class="line"># check the configuration output to ensure that jack is configured properly as explained above.</div>
<div class="line"># otherwise, find the missing libraries and install them before reconfiguring.</div>
<div class="line"> </div>
<div class="line"># build jack</div>
<div class="line">./waf</div>
<div class="line"> </div>
<div class="line"># install jack on your system</div>
<div class="line">sudo ./waf install</div>
</div><!-- fragment --><p>Now, you must also configure your linux system to allow jack to use realtime scheduling. As for that, you may always advice the <a href="https://jackaudio.org/faq/linux_rt_config.html">relevant guide</a> from the official website, where the whole procedure is summarized in 3 steps.<br  />
 1) adding the lines: </p><div class="fragment"><div class="line">@audio   -  rtprio     95</div>
<div class="line">@audio   -  memlock    unlimited</div>
</div><!-- fragment --><p>... in the <code>/etc/security/limits.conf</code> or the <code>/etc/security/limits.d/audio.conf</code> (depending on whether <code>/etc/security/limits.d</code> exists on your system) <br  />
 2) creating an <code>audio</code> group and adding your user-id to the group: </p><div class="fragment"><div class="line">groupadd audio</div>
<div class="line">usermod -a -G audio yourUserID</div>
<div class="line">usermod -a -G theGroupName yourUserId</div>
</div><!-- fragment --><p>3) Log-out and log-in.</p>
<h4>Installing <code>libjsoncpp</code></h4>
<p>Use the package manager to install <b>jsoncpp</b> library along with the development files. Otherwise build it <a href="https://github.com/open-source-parsers/jsoncpp">from source</a>.</p>
<h4>Installing <code>AudioFile</code></h4>
<p>No need to install. AudioFile header is already included within the <a href="../../external">external</a> directory.</p>
<h4>Installing <code>libevdev</code></h4>
<p>Install <code>libevdev</code> to use Piloop in the <code>PC mode</code>, and to use the pc-keyboard. Use the package manager to install <b>libevdev</b> library along with the development packages.</p>
<h4>Installing <code>wiringPi</code></h4>
<p>Install <code>wiringPi</code> library along with the development files only if you want to run Piloop using the GPIO-based interface. To install, follow visit the <a href="https://github.com/WiringPi/WiringPi">wiringpi repository</a> and follow the installation instructions.</p>
<p><b>IMPORTANT</b> : To use Piloop in <code>RPI mode</code>, you must complete the Raspberry Pi setup to connect the buttons, the potentiometers and the LEDs to the GPIO headers of the rpi device. TO do this, follow the instructions provided in this guide</p>
<h2></h2>
<p>Check the manual to learn how to use Piloop </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
